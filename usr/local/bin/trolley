#!/usr/bin/env python

import os
import urllib2
import json
from sys import argv

host    = 'http://boxcar-addons-staging.herokuapp.com'
command = ''
package_name    = ''
package_version = ''

# Get input
if len(argv) == 4:
  script, command, package_name, package_version = argv
elif len(argv) == 3:
  script, command, package_name = argv
else:
  print "trolley install NAME [VERSION]"
  print "trolley search NAME"
  exit()

def install():
  print "Getting package data"
  package = get_package_data('/packages/' + package_name + '/' + package_version)

  if not package_version:
    package = package[0]

  # Download package
  print "Downloading"
  os.system('wget -q http://slackware.cs.utah.edu/pub/slackware/' + package['path'])

  # Install package
  print "Installing"
  os.system('installpkg ' + package_name)

def remove():
  os.system('removepkg ' + package_name)

def get_package_data(path):
  response = urllib2.urlopen(host + path)
  return json.load(response)

def search():
  packages = get_package_data('/packages/search?q=' + package_name)

  if packages:
    for p in packages:
      print p['name'] + " (" + ', '.join(p['versions']) + ")"


exec(command + '()')
